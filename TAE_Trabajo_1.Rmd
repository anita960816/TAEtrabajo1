---
title: "TAE Trabajo 1"
author: Camila Ospina Patino ; Ana Maria Vásquez Orrego ; Alejandra Valencia Palacio; Juan Esteban Restrepo Vélez; Jorge Mario Quintero Ocampo
date: "2/26/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Preguntas sobre las dimensiones

> Demográfica:

- ¿De acuerdo a al promedio de habitantes por vivienda ver como se comportan en los diferentes estratos?
- ¿Según el promedio de habitantes por vivienda, en proporción cuantos son hombres y cuantos son mujeres?
- ¿Observar en cúal de los estratos en más común que las personas planifiquen?

>Educación:

- ¿En qué estrato las personas presentan un mayor analfabetismo?
- ¿En que estratos las personas asistieron a universidades públicas y en que estratos asistieron a universidades privadas?
- ¿En que estratos las personas tienen una la percepción de que la educación ha presentado una mejora o sigue siento igual?

> Salud:

- ¿Hay facilidad de acceso al servicio de salud según el estrato?
- ¿Como se ve la afiliación a la seguridad social en los estratos?
- ¿Estado de salud según el estrato en el que se recide?
- ¿Calidad del servicio de salud según el estrato?

> Vivienda:

- ¿En que estrato se evidencia mayor cantidad de personas con vivienda propia?
- ¿Los apartamentos son en su mayoria lugares arrendados o propios?
- ¿En que estrato predomida el adobe revocado para la construccion de paredes?


>Trabajo:

- ¿Cuál es el medio de transporte que más utilizan las personas que desean cambiar de empleo?
- ¿Cuál es el rango de tiempo de desplazamiento a su lugar de trabajo que más emplean las personas que desean cambiar de empleo?
- ¿Cuál es la actividad que más realizan las personas que desean conseguir empleo?

## Cargar las librerias necesarias para el trabajo

```{r}
library(ggplot2)
library(tidyverse)
library(corrplot)
library(scales)
library(data.table)
library(rgdal)
library(leaflet)
library(htmlwidgets)
library(maptools)
```

Cargar la base de datos la cual se descargo desde http://medata.gov.co/dataset/encuesta-calidad-de-vida 

Al leer la base, pusimos los niveles -99, -98, -88 y -77 como si fueran NULL´s ya que hacen referencia a respuestas de las parsonas como no sabe, no responde o no aplica y como son respuestas que no nos dicen nada realmente significativo, las reunimos como una misma variable.

```{r}
ecv <- fread("encuesta_calidad_vida.csv",na=c(NULL,"-99","-98","-88","-77"), encoding = "UTF-8")

str_replace("encuesta_calidad.barrio", "ANDALUCIA", "ANDALUCÍA") %>%
str_replace("Nº 2", "NO.2") %>% 
str_replace("Nº 1", "NO.1") %>% 
str_replace("Nº 3", "NO.3") %>%
str_replace("AREA EXPANSION", "ÁREA DE EXPANSIÓN") %>%
str_replace("EXPANCION", "EXPANSIÓN") %>% 
str_replace("AREA", "ÁREA") %>% 
str_replace("BOMBONA", "BOMBONÁ") %>% 
str_replace("LA ASOMADERA", "ASOMADERA") %>%
str_replace("BELALCAZAR", "BELALCÁZAR") %>% 
str_replace("CALAZANS", "CALASANZ") %>% 
str_replace("COLON", "COLÓN") %>% 
str_replace("MIRA FLORES", "MIRAFLORES") %>% 
str_replace("BARRIO FACULTAD DE MINAS", "FACULTAD DE MINAS") %>% 
str_replace("CABECERA SAN ANT DE PR.", "SAN ANTONIO DE PRADO") %>% 
str_replace("CARLOS E RESTREPO", "CARLOS E. RESTREPO") %>% 
str_replace("URQUITA", "URQUITÁ") %>% 
str_replace("LOS CERROS EL VERJEL", "LOS CERROS EL VERGEL") %>% 
str_replace("CAYCEDO", "CAICEDO") %>% 
str_replace("VALDES", "VALDÉS") %>% 
str_replace("CERRO EL VOLADOR", "B. CERRO EL VOLADOR") %>% 
str_replace("MOSCU", "MOSCÚ") %>% 
str_replace("JOSELA", "JOSÉ LA") %>%
str_replace("JOSE", "JOSÉ") %>% 
str_replace("EL YOLOMBO", "YOLOMBO") %>% 
str_replace("PIEDRAS BLANCAS", "PIEDRAS BLANCAS - MATASANO") %>% 
str_replace("BASILIA", "BRASILIA") %>% 
str_replace("VILLA TINA", "VILLATINA") %>% 
str_replace("LILIAM", "LILLIAM") %>% 
str_replace("BOLIVAR", "BOLÍVAR") %>% 
str_replace("CORREGIMIENTO PALMITAS", "PALMITAS SECTOR CENTRAL") %>% 
str_replace("INES", "INÉS") %>% 
str_replace("FE", "FÉ") %>% 
str_replace("LUCIA", "LUCÍA") %>% 
str_replace("SABIO", "SAVIO") %>% 
str_replace("BERMEJAL- LOS ÁLAMOS", "BERMEJAL-LOS ÁLAMOS") %>% 
str_replace("BOLÍVARIANA", "BOLIVARIANA") %>% 
str_replace("EL NOGAL - LOS ALMENDROS", "EL NOGAL-LOS ALMENDROS") %>% 
str_replace("JUAN XXIII - LA QUIEBRA", "JUAN XXIII LA QUIEBRA") %>% 
str_replace("PROGRESO  Nº 2", "EL PROGRESO") %>% 
str_replace("MARIA", "MARÍA") %>% 
str_replace("PLAYÓN", "PLAYON") %>% 
str_replace("EL SOCORRO / LA GABRIELA", "EL SOCORRO") %>% 
str_replace("FÉRRINI", "FERRINI") %>% 
str_replace("LA CANDE LARIA", "LA CANDELARIA") %>%
str_replace("EL PLAYON", "PLAYÓN") %>%
str_replace("IGUANA", "IGUANÁ") %>%
str_replace("MARÍA CANO - CARAMBOLAS", "MARÍA CANO-CARAMBOLAS") %>%
str_replace("DE ABURRA", "DEL ABURRÁ") %>%
str_replace("ALTAVISTA CENTRAL", "ALTAVISTA SECTOR CENTRAL") %>%
str_replace("SECTOR CENTRAL", "CENTRO ADMINISTRATIVO") %>%
str_replace("ALTAVISTA CENTRO ADMINISTRATIVO", "ALTAVISTA SECTOR CENTRAL") %>%
str_replace("SANTA ELENA CENTRO ADMINISTRATIVO", "SANTA ELENA SECTOR CENTRAL") %>%
str_replace("PALMITAS CENTRO ADMINISTRATIVO", "PALMITAS SECTOR CENTRAL") %>%  
str_replace("PROGRESO", "EL PROGRESO")
```

Resumen de nuestra base de datos

```{r}
head(ecv)
dim(ecv)
glimpse(ecv)
```


# Preseleccion:

Las variables que van a formar parte de cada una de las dimensiones escogidas teniendo en cuenta el último año en que se realizo la encuesta, las cuales fueron: Demográfica, Educación, Trabajo, Vivienda y Salud

**Demográfica**

```{r}
Demo <- subset(ecv,encuesta_calidad.año == "2018",select = c("encuesta_calidad.barrio",
"encuesta_calidad.p_10","encuesta_calidad.p_12", "encuesta_calidad.p_15", "encuesta_calidad.p_18",
"encuesta_calidad.p_308","encuesta_calidad.p_23"))
```

**Educación**

```{r}
dimEdu <- subset(ecv, encuesta_calidad.año=="2018", select=c("encuesta_calidad.barrio", "encuesta_calidad.estrato", "encuesta_calidad.p_35", "encuesta_calidad.p_45", "encuesta_calidad.p_49", "encuesta_calidad.p_262"))
```

**Salud**

```{r}
dimSalud <- subset(ecv,encuesta_calidad.año == "2018",select = c(encuesta_calidad.barrio, encuesta_calidad.estrato, encuesta_calidad.p_15, encuesta_calidad.p_18, encuesta_calidad.p_57, encuesta_calidad.p_66, encuesta_calidad.p_265, encuesta_calidad.p_266, encuesta_calidad.p_342))
```

**Vivienda**

```{r}
dimVivienda <- subset(ecv,encuesta_calidad.año=="2018",select=c("encuesta_calidad.barrio",           "encuesta_calidad.estrato","encuesta_calidad.p_12","encuesta_calidad.p_146","encuesta_calidad.p_147",  "encuesta_calidad.p_148","encuesta_calidad.p_157","encuesta_calidad.p_158","encuesta_calidad.p_162", "encuesta_calidad.p_165","encuesta_calidad.p_174","encuesta_calidad.p_182","encuesta_calidad.p_226"))
```

**Trabajo**

```{r}
Tra <- subset(ecv,encuesta_calidad.año=="2018",select=c("encuesta_calidad.barrio","encuesta_calidad.p_69",  "encuesta_calidad.p_74","encuesta_calidad.p_75","encuesta_calidad.p_83", "encuesta_calidad.p_84","encuesta_calidad.p_100"))
```


Mirar como quedan las preselecciones

```{r}
glimpse(Demo)
glimpse(dimEdu)
glimpse(dimSalud)
glimpse(dimVivienda)
glimpse(Tra)
```


Promedios por vivienda con la función tapply() y  proporciones con la función prop.table()
Separamos los niveles de las variables que son cualitativas.

## Dimensión Demográfica:

P_10 : Estrato de las viviendas
Variable por niveles, así que los separamos

```{r}
Estrato <- table(Demo[,c("encuesta_calidad.barrio","encuesta_calidad.p_10")]) 
Estrato <- round(prop.table(Estrato),6)
```

Renombrar las columnas de la tabla

```{r}
colnames (Estrato) = c("Estrato_1", "Estrato_2", "Estrato_3", "Estrato_4", "Estrato_5", "Estrato_6")
dim(Estrato)
```

P_12 : Personas que componen el hogar
Variable continua por lo que sólo le sacamos el promedio de habitantes por vivienda en los barrios.

```{r}
Habitantes <- round(tapply(Demo$encuesta_calidad.p_12, Demo$encuesta_calidad.barrio,  mean, na.rm= TRUE),6)
dim(Habitantes)
```

P_15 : Sexo
Se separa por niveles

```{r}
Sexo <- table(Demo[,c("encuesta_calidad.barrio","encuesta_calidad.p_15")]) 
Sexo <- round(prop.table(Sexo),6)
```

Renombrar las columnas ue se generan

```{r}
colnames (Sexo) = c("Hombre","Mujer")
dim(Sexo)
```

P_18 : Edad en años cumplidos
Edad al ser una variable continua no se hace por niveles, solo un promedio

```{r}
Edad <- round(tapply(Demo$encuesta_calidad.p_18, Demo$encuesta_calidad.barrio,  mean, na.rm= TRUE),6)
dim(Edad)
```

P_23 : Etnia
Se separa por niveles

```{r}
Etnia <- table(Demo[,c("encuesta_calidad.barrio","encuesta_calidad.p_23" )]) 
Etnia <- round(prop.table(Etnia),6)
```

Renombrar las columnas que se generan

```{r}
colnames (Etnia) = c( "Indigena", "Negro_Mulato", "Mestizo", "Blanco", "Raizal_Sanandresano","Rom_Gitano")
dim(Etnia)
```


P_308 : Usted planifica

```{r}
Planificacion <- table(Demo[,c("encuesta_calidad.barrio","encuesta_calidad.p_308" )]) 
Planificacion <- round(prop.table(Planificacion),6)
```

Renombrar las columnas que se generan

```{r}
colnames (Planificacion) = c( "Si_Planifica", "No_Planifica")
dim(Planificacion)
```

**Matriz Demográfica**

Usando la función cbind() unificamos todas las columnas generadas en el anterior paso, así nuestra base de dimensión demográfica va quedar con clase matrix.

```{r}
DimDemo1 <- cbind(Estrato,Habitantes,Sexo,Edad,Etnia,Planificacion)
```

```{r}
dim(DimDemo1)
colnames(DimDemo1)
```

Como nuestra base tiene formato de matriz, sólo para hacer las gráficas descriptivas ponemos nuestra base como un data frame.

```{r}
DimDemo_1 <- as.data.frame(DimDemo1)
```

**Gráficas descriptivas**

Promedio de habitantes en las viviendas ~ Estratos

```{r}
GrDm_1 <-  ggplot(data = DimDemo_1, aes(x=Habitantes , y = Estrato_1)) + 
  geom_point(size = 3, alpha=I(0.5),col="blue") + 
  labs(x = "Habitantes por vivienda", y= "Estrato 1") + ggtitle(" Habitantes en el Estrato 1")
GrDm_1

GrDm_2 <-  ggplot(data = DimDemo_1, aes(x=Habitantes , y = Estrato_2)) + 
  geom_point(size = 3, alpha=I(0.5),col="#33CCCC") + 
  labs(x = "Habitantes por vivienda", y= "Estrato 2") + ggtitle(" Habitantes en el Estrato 2")
GrDm_2

GrDm_3 <-  ggplot(data = DimDemo_1, aes(x=Habitantes , y = Estrato_3)) + 
  geom_point(size = 3, alpha=I(0.5),col="#33CC99") + 
  labs(x = "Habitantes por vivienda", y= "Estrato 3") + ggtitle(" Habitantes en el Estrato 3")
GrDm_3

GrDm_4 <-  ggplot(data = DimDemo_1, aes(x=Habitantes , y = Estrato_4)) + 
  geom_point(size = 3, alpha=I(0.5),col="#CC33FF") + 
  labs(x = "Habitantes por vivienda", y= "Estrato 4") + ggtitle(" Habitantes en el Estrato 4")
GrDm_4

GrDm_5 <-  ggplot(data = DimDemo_1, aes(x=Habitantes , y = Estrato_5)) + 
  geom_point(size = 3, alpha=I(0.5),col="#6600FF") + 
  labs(x = "Habitantes por vivienda", y= "Estrato 5") + ggtitle(" Habitantes en el Estrato 5")
GrDm_5

GrDm_6 <-  ggplot(data = DimDemo_1, aes(x=Habitantes , y = Estrato_6)) + 
  geom_point(size = 3, alpha=I(0.5),col="#CC66FF") + 
  labs(x = "Habitantes por vivienda", y= "Estrato 6") + ggtitle(" Habitantes en el Estrato 6")
GrDm_6
```
Es notorio en las gráficas que en los estratos 1, 2 y 3 hay un mayor número de habitantes por vivienda, mostrando que en promedio hay al menos mas de tres habitantes por vivienda y en los los estratos 1 y 2 como se ve que son en promedio mas de cuatro habitantes por vivienda en su mayoría. Mientras que en los estratos 4, 5 y 6 se evidencia que en promedio el número de habitantes por vivienda es menor que cuatro.


Estratos ~ Si Planifica

```{r}
GrDm_9 <-  ggplot(data = DimDemo_1, aes(x=Estrato_1 , y =Si_Planifica )) + 
  geom_point(size = 3, alpha=I(0.5),col="#666600") + 
  labs(x = "Estrato_1", y= "Si Planifica") + ggtitle(" estrato 1 que plaifican")
GrDm_9

GrDm_9 <-  ggplot(data = DimDemo_1, aes(x=Estrato_2 , y =Si_Planifica )) + 
  geom_point(size = 3, alpha=I(0.5),col="#666600") + 
  labs(x = "Estrato_2", y= "Si Planifica") + ggtitle(" estrato 2 que plaifican")
GrDm_9

GrDm_11 <-  ggplot(data = DimDemo_1, aes(x=Estrato_3 , y =Si_Planifica )) + 
  geom_point(size = 3, alpha=I(0.5),col="#666600") + 
  labs(x = "Estrato_3", y= "Si Planifica") + ggtitle(" estrato 3 que plaifican")
GrDm_11

GrDm_12 <-  ggplot(data = DimDemo_1, aes(x=Estrato_4 , y =Si_Planifica )) + 
  geom_point(size = 3, alpha=I(0.5),col="#666600") + 
  labs(x = "Estrato_4", y= "Si Planifica") + ggtitle(" estrato 4 que plaifican")
GrDm_12

GrDm_13 <-  ggplot(data = DimDemo_1, aes(x=Estrato_5 , y =Si_Planifica )) + 
  geom_point(size = 3, alpha=I(0.5),col="#666600") + 
  labs(x = "Estrato_5", y= "Si Planifica") + ggtitle(" estrato 5 que plaifican")
GrDm_13

GrDm_14 <-  ggplot(data = DimDemo_1, aes(x=Estrato_6 , y =Si_Planifica )) + 
  geom_point(size = 3, alpha=I(0.5),col="#666600") + 
  labs(x = "Estrato_6", y= "Si Planifica") + ggtitle(" estrato 6 que plaifican")
GrDm_14

```
Se ve como en proporciones y a grandes rasgos las personas de los estratos 1, 2 y 3 planifican más, por el contrario se ve como en pequeñas proporciones los estratos 4, 5 y 6 planifican menos.


Etnias

```{r}
panel.hist <- function(x, ...)
{
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(usr[1:2], 0, 1.5) )
    h <- hist(x, plot = FALSE)
    breaks <- h$breaks; nB <- length(breaks)
    y <- h$counts; y <- y/max(y)
    rect(breaks[-nB], 0, breaks[-1], y, col = "cyan", ...)
}
panel.cor <- function(x, y, digits = 2, prefix = "", cex.cor, ...)
{
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(0, 1, 0, 1))
    r <- abs(cor(x, y))
    txt <- format(c(r, 0.123456789), digits = digits)[1]
    txt <- paste0(prefix, txt)
    if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
    text(0.5, 0.5, txt, cex = cex.cor * r)
}
GrD_15 <- pairs(DimDemo_1[,11:16], lower.panel = panel.smooth, upper.panel = panel.cor,
      gap=0, row1attop=FALSE)
```
Realmente la gráfica nos muestra como en Medellín no hay un índice muy alto de habitantes pertenecientes a una etnia en particular y las únicas que podrían decir algo, son las etnias Blanco y Meztizo, que son las etnias a las que una mayor parte de la población pertenece, sin embargo las proporciones de pertenecia son muy bajas.


Edad ~ Sexo

```{r}
GrDm_16 <-  ggplot(data = DimDemo_1, aes(x=Edad , y =Hombre )) + 
  geom_point(size = 3, alpha=I(0.5),col="#CC0000") + 
  labs(x = "Edad", y= "Hombre") + 
  ggtitle(" Edad Hombres")
GrDm_16

GrDm_17 <-  ggplot(data = DimDemo_1, aes(x=Edad , y =Mujer )) + 
  geom_point(size = 3, alpha=I(0.5),col="#6699FF") + 
  labs(x = "Edad", y= "Mujer") + 
  ggtitle(" Edad Mujeres")
GrDm_17
```
Se ve como no hay ningún cambio entre la edad de las mujeres y los hombres que fueron encuestados y sin embargo aunque leve, hay un poco más de mujeres que estan entre los 30 y los 40 años.

## Dimensión Educación


```{r}
names(dimEdu)[1]<-"Barrio"
names(dimEdu)[2]<-"Estrato"
names(dimEdu)[3]<-"Sabe_leer_y_escribir"
names(dimEdu)[4]<-"Ultimo_nivel_de_estudio_aprobado"
names(dimEdu)[5]<-"Caracter_del_establecimiento_educativo"
names(dimEdu)[6]<-"Educacion_brindada_es"
names(dimEdu)
```


Promedios y proporciones en las variables seleccionadas
Cambiando los nombres de las nuevas columnas que van a ser generadas en la separación de las variables que tienen niveles cualitativos.

Renombre de las variables de salida.

```{r}
dimEdu$Estrato <- factor(dimEdu$Estrato)
levels(dimEdu$Estrato) <- c("Estrato_1", "Estrato_2", "Estrato_3", "Estrato_4", "Estrato_5", "Estrato_6")

dimEdu$Sabe_leer_y_escribir <- factor(dimEdu$Sabe_leer_y_escribir)
levels(dimEdu$Sabe_leer_y_escribir) <- c("Sí", "No")


dimEdu$Ultimo_nivel_de_estudio_aprobado <- factor(dimEdu$Ultimo_nivel_de_estudio_aprobado)
levels(dimEdu$Ultimo_nivel_de_estudio_aprobado) <- c("Ninguno", "Salacuna","Primaria", "Secundaria","Media académica_o_Normalista", "Media_Técnica","Tecnológico", "Universidad","Especializacion", "Maestria","Doctorado")

dimEdu$Caracter_del_establecimiento_educativo <- factor(dimEdu$Caracter_del_establecimiento_educativo)
levels(dimEdu$Caracter_del_establecimiento_educativo) <- c("Público","Privado")

dimEdu$Educacion_brindada_es <- factor(dimEdu$Educacion_brindada_es)
levels(dimEdu$Educacion_brindada_es) <- c("Mejorado","Igual","Empeorado")
```

Proporción por Ultimo_nivel_de_estudio_aprobado
 
```{r}
nivel_estudio<-table(dimEdu[,c("Barrio","Ultimo_nivel_de_estudio_aprobado")])
nivel_estudio <- round(prop.table(nivel_estudio),6)
dim(nivel_estudio)
```

Proporción Sabe leer y escribir

```{r}
lee_escribe<-table(dimEdu[,c("Barrio","Sabe_leer_y_escribir")])
lee_escribe <- round(prop.table(lee_escribe),6)
dim(lee_escribe)
```

Proporción Caracter del establecimiento educativo

```{r}
estableccimiento_educativo<-table(dimEdu[,c("Barrio","Caracter_del_establecimiento_educativo")])
estableccimiento_educativo <- round(prop.table(estableccimiento_educativo),6)
dim(estableccimiento_educativo)
```

Proporción La educación brindada es igual, a mejorado o a empeorado

```{r}
educacion_brindada<-table(dimEdu[,c("Barrio","Educacion_brindada_es")])
educacion_brindada <- round(prop.table(educacion_brindada),6)
dim(educacion_brindada)
```

Estratos

```{r}
estrato <- table(dimEdu[,c("Barrio","Estrato")]) 
estrato <- round(prop.table(estrato),6)
dim(estrato)
```

**Matriz de la dimensión educación**

Con cbind(), la cual hace que nuestra base quede con clase matrix

```{r}
matEdu <- cbind(estrato, educacion_brindada, estableccimiento_educativo,lee_escribe,nivel_estudio)
dim(matEdu)
colnames(matEdu)
```

Sólo para hacer las gráficas descriptivas ponemos nuestra matriz como un data frame

```{r}
matrizEdu<- as.data.frame(matEdu)
colnames(matrizEdu)
```

**Gráficas descriptivas de la dimensión educación.**

Estrato ~ No sabe leer.

```{r}
g_lee_escribe <- ggplot(matrizEdu,aes(x=No ,y = Estrato_2)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "No sabe leer" , y = "Estrato 2") + ggtitle("Personas que no saben leer en estrato 2")
g_lee_escribe
```

Luego de haber hecho una función una función pairs de Los estratos y la variable no sabe leer, se pudo ver que sólo presentaban una relación significativa el Estrato 2 y No sabe leer.
Así que despues de ver esta gráfica se puede decir que las personas de estrato 2 no saben leer ni escribir y son la población con mayor índice de analfabetismo.

Estratos ~ Universida pública/ Universidad privada.

```{r}
e1_u_publico <- ggplot(matrizEdu,aes(x="Público" ,y = Estrato_1)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Establecimiento educativo público" , y = "Estrato 1") + ggtitle("Personas de estrato 1 que estudiaron en una universidad pública")
e1_u_publico
```
```{r}
e2_u_publico <- ggplot(matrizEdu,aes(x=Público ,y = Estrato_2)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Establecimiento educativo público" , y = "Estrato 2") + ggtitle("Personas de estrato 2 que estudiaron en una universidad pública")
e2_u_publico
```
```{r}
e3_u_publico <- ggplot(matrizEdu,aes(x=Público ,y = Estrato_3)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Establecimiento educativo público" , y = "Estrato 3") + ggtitle("Personas de estrato 3 que estudiaron en una universidad pública")
e3_u_publico
```
```{r}
e4_u_publico <- ggplot(matrizEdu,aes(x=Público ,y = Estrato_4)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Establecimiento educativo público" , y = "Estrato 4") + ggtitle("Personas de estrato 4 que estudiaron en una universidad pública")
e4_u_publico

e6_u_privado <- ggplot(matrizEdu,aes(x=Privado ,y = Estrato_6)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Establecimiento educativo privado" , y = "Estrato 4") + ggtitle("Personas de estrato 6 que estudiaron en una universidad privada")
e6_u_privado

```

Las personad de los estratos 1 a 4 son las que más asisten a establecientos públicos, en este caso a universidades públicas, eso nos dice que los habitantes de los estratos 5 y 6 por lo general asistena  establecimientos educativos de caracter privado.

Estratos ~ Mejora de la educación

```{r}
e2_edu_mejor <- ggplot(matrizEdu,aes(x=Mejorado ,y = Estrato_2)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Percepción del nivel de educación" , y = "Estrato 2") + ggtitle("Personas de estrato 2 que creen que el nivel de educación ha mejorado")
e2_edu_mejor

e2_edu_igual <- ggplot(matrizEdu,aes(x=Igual ,y = Estrato_2)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Percepción del nivel de educación" , y = "Estrato 2") + ggtitle("Personas de estrato 2 que creen que el nivel de educación sigue igual")
e2_edu_igual

e3_edu_mejor <- ggplot(matrizEdu,aes(x=Mejorado ,y = Estrato_3)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Percepción del nivel de educación" , y = "Estrato 3") + ggtitle("Personas de estrato 3 que creen que el nivel de educación ha mejorado")
e3_edu_mejor

e3_edu_igual <- ggplot(matrizEdu,aes(x=Igual ,y = Estrato_3)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Percepción del nivel de educación" , y = "Estrato 3") + ggtitle("Personas de estrato 3 que creen que el nivel de educación sigue igual")
e3_edu_igual

e3_edu_ <- ggplot(matrizEdu,aes(x=Igual ,y = Estrato_3)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Percepción del nivel de educación" , y = "Estrato 3") + ggtitle("Personas de estrato 3 que creen que el nivel de educación sigue igual")
e3_edu_igual
```
Para las personas de estratos más bajos, como son el estrato 2 y 3 se tiene una percepción de que la educación ha mejorado y/o se ha mantenido igual, pero para las personas de más recursos (estratos 5 y 6) tienen una percepción diferente, llegando a percibir que la educación se ha mantenido igual y que ha empeorado.

## Dimensión Salud

Se hacen los cambios de clase necesarios en las variables originales

```{r}
dimSalud$estado_salud<- as.integer(dimSalud$estado_salud)
dimSalud$sindrome_down<- as.integer(dimSalud$sindrome_down)

glimpse(dimSalud)
```

Proporciones y Promedios por vivienda con la funcion tapply y prop.table
Separamos por niveles las que son variables discretas
```{r}
names(dimSalud)[1] <- "barrio"
names(dimSalud)[2] <- "estrato"
names(dimSalud)[3] <- "sexo"
names(dimSalud)[4] <- "edad"
names(dimSalud)[5] <- "sindrome_down"
names(dimSalud)[6] <- "afiliacion_seguridad_social"
names(dimSalud)[7] <- "facilidad_acceso_servicio_salud"
names(dimSalud)[8] <- "calidad_servicio_salud"
names(dimSalud)[9] <- "estado_salud"

```


```{r}
estrato <- table(dimSalud[,c("barrio","estrato")]) 
estrato <- round(prop.table(estrato),6)


sexo <- table(dimSalud[,c("barrio","sexo")]) 
sexo <- round(prop.table(sexo),6)


sindrome_down <- table(dimSalud[,c("barrio","sindrome_down")]) 
sindrome_down <- round(prop.table(sindrome_down),6)

afiliacion_seguridad_social <- table(dimSalud[,c("barrio","afiliacion_seguridad_social")]) 
afiliacion_seguridad_social <- round(prop.table(afiliacion_seguridad_social),6)

facilidad_acceso_servicio_salud <- table(dimSalud[,c("barrio","facilidad_acceso_servicio_salud")]) 
facilidad_acceso_servicio_salud <- round(prop.table(facilidad_acceso_servicio_salud),6)

calidad_servicio_salud <- table(dimSalud[,c("barrio","calidad_servicio_salud")]) 
calidad_servicio_salud <- round(prop.table(calidad_servicio_salud),6)

estado_salud <- table(dimSalud[,c("barrio","estado_salud")]) 
estado_salud <- round(prop.table(estado_salud),6)

```

Renombrar las columnas que se generan nuevas de las originales que se dividen en sus propias categorías.

```{r}
colnames (estrato) = c("Estrato_1", "Estrato_2", "Estrato_3", "Estrato_4", "Estrato_5", "Estrato_6")

colnames (sexo) = c("Masculino", "Femenino")

colnames (sindrome_down) = c("Sí", "No")

colnames (afiliacion_seguridad_social) = c("Tiene_EPS", "Beneficiario_EPS", "tiene_EPS_Subsidiada", "Régimen_especial", "Beneficiario_Régimen_especial", "SISBEN", "No_SISBEN")

colnames (facilidad_acceso_servicio_salud) = c("Muy_mala_facilidad", "Mala_facilidad", "Aceptable_facilidad", "Buena_facilidad", "Muy_buena_facilidad")

colnames (calidad_servicio_salud) = c("Muy_mala_calidad", "Mala_calidad", "Aceptable_calidad", "Buena_calidad", "Muy_buena_calidad")

colnames (estado_salud) = c("estado_salud_Malo", "estado_salud_Regular", "estado_salud_Bueno", "estado_salud_Excelente")
```

**Matriz de la dimensión salud**

Con la función cbind().

```{r}
dimSalud1 <- cbind(estrato,sexo, sindrome_down, afiliacion_seguridad_social, facilidad_acceso_servicio_salud, calidad_servicio_salud, estado_salud)
```

Para hacer nuestras gráficas descriptivas ponemos nuestra base de dimensión como un data frame.

```{r}
dimSalud1 <- as.data.frame(dimSalud1)
```

**Gráficas descriptivas Salud**

Estrato ~ Facilidad Acceso Servicio de Salud

```{r}
GrSd_1 <- ggplot(dimSalud1,aes(x=Buena_facilidad ,y = Estrato_2)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Facilidad acceso servicio salud" , y = "Estrato 2") + ggtitle("Buena facilidad de acceso al servicio de salud en el estrato 2")
GrSd_1

GrSd_2 <- ggplot(dimSalud1,aes(x=Mala_facilidad ,y = Estrato_2)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Facilidad acceso servicio salud" , y = "Estrato 2") + ggtitle("Mala facilidad de acceso al servicio de salud en el estrato 2")
GrSd_2

GrSd_3 <- ggplot(dimSalud1,aes(x=Aceptable_facilidad ,y = Estrato_2)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Facilidad acceso servicio salud" , y = "Estrato 2") + ggtitle("Aceptable facilidad de acceso al servicio de salud en el estrato 2")
GrSd_3

GrSd_4 <- ggplot(dimSalud1,aes(x=Muy_mala_facilidad ,y = Estrato_2)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Facilidad acceso servicio salud" , y = "Estrato 2") + ggtitle("Muy mala facilidad de acceso al servicio de salud en el estrato 2")
GrSd_4
```

Después de hacer una gráfica pairs de los estratos y la facilidad al acceso de salud se pudo ver que la única combinación que tenia alguna importancia comparar era el Estrato 2 con los diferentes niveles de Acceso al servicio de salud.
Las personas que tienen  un buen acceso al servicio de salud son las que pertenecen a los estratos 2 y 3 y manifiestan que es aceptable y bueno, pero no muy bueno.

Estrato ~ Tiene EPS

```{r}
GrSd_5 <- ggplot(dimSalud1,aes(x=Tiene_EPS ,y = Estrato_2)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Afiliacion seguridad social" , y = "Estrato 2") + ggtitle("Afiliacion seguridad social EPS en el estrato 2")
GrSd_5

GrSd_6 <- ggplot(dimSalud1,aes(x=Beneficiario_EPS ,y = Estrato_2)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Afiliacion seguridad social" , y = "Estrato 2") + ggtitle("Afiliacion seguridad social Beneficiario EPS en el estrato 2")
GrSd_6

GrSd_7 <- ggplot(dimSalud1,aes(x=tiene_EPS_Subsidiada ,y = Estrato_2)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Afiliacion seguridad social" , y = "Estrato 2") + ggtitle("Afiliacion seguridad social EPS subsidiada en el estrato 2")
GrSd_7

GrSd_8 <- ggplot(dimSalud1,aes(x=Tiene_EPS ,y = Estrato_3)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Afiliacion seguridad social" , y = "Estrato 3") + ggtitle("Afiliacion seguridad social EPS en el estrato 3")
GrSd_8

GrSd_9 <- ggplot(dimSalud1,aes(x=Beneficiario_EPS ,y = Estrato_3)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Afiliacion seguridad social" , y = "Estrato 3") + ggtitle("Afiliacion seguridad social Beneficiario EPS en el estrato 3")
GrSd_9
```

Después de hacer una gráfica pairs de los estratos y la facilidad al acceso de salud se pudo ver que la única combinación que tenia alguna importancia comparar era el Estrato 2 y Estrato 3 con los diferentes niveles de Tiene EPS. La aficiliación en el estrato 2 es en mayor proporción de nivel subsidiado y EPS.

Estrato ~Estado de Salud

```{r}
GrSd_10 <- ggplot(dimSalud1,aes(x=estado_salud_Bueno ,y = Estrato_1)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Estado de salud bueno" , y = "Estrato 1") + ggtitle("Estado de salud con respecto al estrato")
GrSd_10

GrSd_11 <- ggplot(dimSalud1,aes(x=estado_salud_Bueno ,y = Estrato_2)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Estado de salud bueno" , y = "Estrato 2") + ggtitle("Estado de salud con respecto al estrato")
GrSd_11

GrSd_12 <- ggplot(dimSalud1,aes(x=estado_salud_Bueno ,y = Estrato_3)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Estado de salud bueno" , y = "Estrato 3") + ggtitle("Estado de salud con respecto al estrato")
GrSd_12
```

Después de hacer una gráfica pairs de los estratos y la facilidad al acceso de salud se pudo ver que la única combinación que tenia alguna importancia comparar era el Estrato 1, Estrato 2 y Estrato 3 con los diferentes niveles de Tiene EPS. Se puede apreciar como las personas de más bajos rercusos tienen una percepción del estado de salud variado, en el estrato 3 al haber un mayor número de encuestados se percibe un mejor estado de salud.

Estrato ~ Calidad del serivicio de Salud

```{r}
GrSd_13 <- ggplot(dimSalud1,aes(x=Aceptable_calidad ,y = Estrato_2)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Calidad del servicio de salud aceptable" , y = "Estrato 2") + ggtitle("Calidad del servicio de salud con respecto al estrato")
GrSd_13

GrSd_14 <- ggplot(dimSalud1,aes(x=Buena_calidad ,y = Estrato_2)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Calidad del servicio de salud buena" , y = "Estrato 2") + ggtitle("Calidad del servicio de salud con respecto al estrato")
GrSd_14
```

Después de hacer una gráfica pairs de los estratos y la facilidad al acceso de salud se pudo ver que la única combinación que tenia alguna importancia comparar era el Estrato 2  con los diferentes niveles de. Según la percepción de los encuestados del estrato 2 la percepción es buena.


## Dimension Vivienda

Renombrar las columnas

```{r}
names(dimVivienda)
names(dimVivienda)[1] <- "Barrio"
names(dimVivienda)[2] <- "Estrato"
names(dimVivienda)[3] <- "cantidad_personas_hogar"
names(dimVivienda)[4] <- "tipo_vivienda"
names(dimVivienda)[5] <- "material_paredes_externas"
names(dimVivienda)[6] <- "material_pisos"
names(dimVivienda)[7] <- "numero_cuartos"
names(dimVivienda)[8] <- "tiene_energia"
names(dimVivienda)[9] <- "tiene_acueducto"
names(dimVivienda)[10] <- "tiene_alcantarillado"
names(dimVivienda)[11] <- "tiene_aseo(recoleccion)"
names(dimVivienda)[12] <- "afectada_desastres"
names(dimVivienda)[13] <- "hogar_arrendado_o_pago"
```

Proporciones con prop.table y Promedios con la funcion tapply
Y renombrar las calomnas nuevas que se crean de los niveles

Estrato

```{r}
Estrato <- table(dimVivienda[,c("Barrio","Estrato")]) 
Estrato <- round(prop.table(Estrato),6)
colnames (Estrato) = c("Estrato_1", "Estrato_2", "Estrato_3", "Estrato_4", "Estrato_5", "Estrato_6")
```

Cantidad de Personas por vivienda

```{r}
cantidad_personas_hogar <-  round(tapply(dimVivienda$cantidad_personas_hogar, dimVivienda$Barrio,  mean, na.rm= TRUE),6)
```

Hogares afectados por desastres

```{r}
afectada_desastres <- table(dimVivienda[,c("Barrio","afectada_desastres")])
afectada_desastres <- round(prop.table(afectada_desastres),6)
colnames (afectada_desastres) = c("Ninguno", "Inundaciones", "Avalancha", "Deslizamiento", "Hundimiento de terreno", "Falla geologica","Incendios")
```

Material de Paredes Exernas

```{r}
material_paredes_externas <- table(dimVivienda[,c("Barrio","material_paredes_externas")])
material_paredes_externas <- round(prop.table(material_paredes_externas),6)
colnames (material_paredes_externas) = c("Materiales_desechos", "Madera_burda1", "Bahareque_sin_revocar", "Bahareque_revocado", "Tapia_pisada",  "Material_prefabricado", "adobe_sin_ranurar", "Bloque_ranurado", "Ladrillo_ranurado","adobe_revocado","bloque_forrado_en_piedra")
```

Material de Pisos

```{r}
material_pisos <- table(dimVivienda[,c("Barrio","material_pisos")])
material_pisos <- round(prop.table(material_pisos),6)
colnames (material_pisos) = c("Tierra", "Madera_burda", "Cemento", "Baldosa", "Marmol",  "Madera_pulida", "alfonbra")
```

La vivienda tiene energia

```{r}
tiene_energia <- table(dimVivienda[,c("Barrio","tiene_energia")])
tiene_energia <- round(prop.table(tiene_energia),6)
colnames(tiene_energia) = c("si_tiene_energia")
```

La vivienda tiene acueducto

```{r}
tiene_acueducto <- table(dimVivienda[,c("Barrio","tiene_acueducto")])
tiene_acueducto <- round(prop.table(tiene_acueducto),6)
colnames(tiene_acueducto) = c("si_tiene_acueducto","no_tiene_acueducto")
tiene_acueducto
```

La vivienda tiene alcantarillado

```{r}
tiene_alcantarillado <- table(dimVivienda[,c("Barrio","tiene_alcantarillado")])
tiene_tiene_alcantarilladoacueducto <- round(prop.table(tiene_alcantarillado),6)
colnames(tiene_alcantarillado) = c("si_tiene_alcantarillado","no_tiene_alcantarillado")
```

Tipo de vivienda ( Tipo de casa )

```{r}
tipo_vivienda <- table(dimVivienda[,c("Barrio","tipo_vivienda")])
tipo_vivienda <- round(prop.table(tipo_vivienda),6)
colnames(tipo_vivienda) = c("tipo_rancho","tipo_cuarto","tipo_inquilinato","tipo_apartamento","tipo_casa")
```

Tipo de vivienda ( Arrendado o Propio)

```{r}
hogar_arrendado_o_pago <- table(dimVivienda[,c("Barrio","hogar_arrendado_o_pago")])
hogar_arrendado_o_pago <- round(prop.table(hogar_arrendado_o_pago),6)
colnames(hogar_arrendado_o_pago) = c("En_arriendo","Propia_pagando","Propia_pagada","Usufructo","Ocaupantes","Anticresis")
```

**Matriz Dimensión Vivienda**

```{r}
matrizVivienda <- cbind(Estrato,cantidad_personas_hogar,afectada_desastres,material_paredes_externas,material_pisos,tiene_energia,tiene_acueducto,tipo_vivienda,tiene_alcantarillado,hogar_arrendado_o_pago)
dim(matrizVivienda)
```

Sólo para hacer las gráficas ponemos la matriz como un data frame

```{r}
matrizVivienda<-as.data.frame(matrizVivienda)
```

**Gráficas Descriptivas dimensión Vivienda**

Cantidad Personas Hogar ~ Tipo Casa

```{r}
e3_edu_igual <- ggplot(matrizVivienda,aes(x=tipo_casa,y = cantidad_personas_hogar)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x =  "Proporcion de personas que viven en una vivienda tipo casa" , y ="Cantidad de personas") + ggtitle("Promedio de personas por hogar tipo casa")
e3_edu_igual
```

Estrato ~ Vivienda propia

```{r}
e3_edu_igual <- ggplot(matrizVivienda,aes(x=Propia_pagada,y = Estrato_1)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Proporcion de viviendas propias y pagas" , y = "Estrato 1") + ggtitle("Personas con casa propia Estrato 1")
e3_edu_igual
e3_edu_igual <- ggplot(matrizVivienda,aes(x=Propia_pagada,y = Estrato_2)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Proporcion de viviendas propias y pagas" , y = "Estrato 2") + ggtitle("Personas con casa propia Estrato 2")
e3_edu_igual
e3_edu_igual <- ggplot(matrizVivienda,aes(x=Propia_pagada,y = Estrato_3)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Proporcion de viviendas propias y pagas" , y = "Estrato 3") + ggtitle("Personas con casa propia Estrato 3")
e3_edu_igual
e3_edu_igual <- ggplot(matrizVivienda,aes(x=Propia_pagada,y = Estrato_4)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Proporcion de viviendas propias y pagas" , y = "Estrato 4") + ggtitle("Personas con casa propia Estrato 4")
e3_edu_igual
e3_edu_igual <- ggplot(matrizVivienda,aes(x=Propia_pagada,y = Estrato_5)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Proporcion de viviendas propias y pagas" , y = "Estrato 5") + ggtitle("Personas con casa propia Estrato 5")
e3_edu_igual
```
Las personas de estrato 2 y 3 son las que evidencian un mayor número de personas con vivienda propia.


Tipo Apartamento ~ Propio/Arrendado

```{r}
e3_edu_igual <- ggplot(matrizVivienda,aes(x=tipo_apartamento,y = En_arriendo)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Proporcion de viviendas tipo apartamentos" , y = "Proporcion de apartamentos en arriendo") + ggtitle("Apartamentos arrendados")
e3_edu_igual
e3_edu_igual <- ggplot(matrizVivienda,aes(x=tipo_apartamento,y = Propia_pagada)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Proporcion de viviendas tipo apartamentos" , y = "Proporcion de apartamentos en comprados") + ggtitle("Proporcion de apartamentos en comprados")
e3_edu_igual
```
La mayoría de apartamentos son viviendas propias.


Estrato ~ Adobe revocado

```{r}
e3_edu_igual <- ggplot(matrizVivienda,aes(x=adobe_revocado,y = Estrato_1)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Proporcion de viviendas con paredes de adobe revocado" , y = "Estrato 1") + ggtitle("Proporcion de viviendas con paredes de adobe revocado en estrato 1")
e3_edu_igual
e3_edu_igual <- ggplot(matrizVivienda,aes(x=adobe_revocado,y = Estrato_2)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Proporcion de viviendas con paredes de adobe revocado" , y = "Estrato 2") + ggtitle("Proporcion de viviendas con paredes de adobe revocado en estrato 2")
e3_edu_igual
e3_edu_igual <- ggplot(matrizVivienda,aes(x=adobe_revocado,y = Estrato_3)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Proporcion de viviendas con paredes de adobe revocado" , y = "Estrato 3") + ggtitle("Proporcion de viviendas con paredes de adobe revocado en estrato 3")
e3_edu_igual
e3_edu_igual <- ggplot(matrizVivienda,aes(x=adobe_revocado,y = Estrato_4)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Proporcion de viviendas con paredes de adobe revocado" , y = "Estrato 4") + ggtitle("Proporcion de viviendas con paredes de adobe revocado en estrato 4")
e3_edu_igual
e3_edu_igual <- ggplot(matrizVivienda,aes(x=adobe_revocado,y = Estrato_5)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Proporcion de viviendas con paredes de adobe revocado" , y = "Estrato 5") + ggtitle("Proporcion de viviendas con paredes de adobe revocado en estrato 5")
e3_edu_igual
e3_edu_igual <- ggplot(matrizVivienda,aes(x=adobe_revocado,y = Estrato_6)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Proporcion de viviendas con paredes de adobe revocado" , y = "Estrato 6") + ggtitle("Proporcion de viviendas con paredes de adobe revocado en estrato 6")
e3_edu_igual
```
Las personas de estrato 2 y 3 son las personas encuestadas que tienen mayor cantidad de viviendas revocadas.


Estrato ~ Pisos Cemento

```{r}
e3_edu_igual <- ggplot(matrizVivienda,aes(x=Cemento,y = Estrato_1)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Proporcion de viviendas con pisos de hechos en cemento" , y = "Estrato 1") + ggtitle("Proporcion de viviendas con pisos de cemento en estrato 1")
e3_edu_igual
e3_edu_igual <- ggplot(matrizVivienda,aes(x=Cemento,y = Estrato_2)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Proporcion de viviendas con pisos de hechos en cemento" , y = "Estrato 2") + ggtitle("Proporcion de viviendas con pisos de cemento en estrato 2")
e3_edu_igual
e3_edu_igual <- ggplot(matrizVivienda,aes(x=Cemento,y = Estrato_3)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Proporcion de viviendas con pisos de hechos en cemento" , y = "Estrato 3") + ggtitle("Proporcion de viviendas con pisos de cemento en estrato 3")
e3_edu_igual
e3_edu_igual <- ggplot(matrizVivienda,aes(x=Cemento,y = Estrato_4)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Proporcion de viviendas con pisos de hechos en cemento" , y = "Estrato 4") + ggtitle("Proporcion de viviendas con pisos de cemento en estrato 4")
e3_edu_igual
e3_edu_igual <- ggplot(matrizVivienda,aes(x=Cemento,y = Estrato_5)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Proporcion de viviendas con pisos de hechos en cemento" , y = "Estrato 5") + ggtitle("Proporcion de viviendas con pisos de cemento en estrato 5")
e3_edu_igual
e3_edu_igual <- ggplot(matrizVivienda,aes(x=Cemento,y = Estrato_6)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Proporcion de viviendas con pisos de hechos en cemento" , y = "Estrato 6") + ggtitle("Proporcion de viviendas con pisos de cemento en estrato 6")
e3_edu_igual
```
En los estratos 2 y 3 se ve claramente como predomina el cemento como elemento en la construcción de pisos y esto tiene bastante sentido ya que es un material económico.


Material piso ~ Estrato 6

```{r}
e3_edu_igual <- ggplot(matrizVivienda,aes(x=Baldosa,y = Estrato_6)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Proporcion de viviendas con pisos de hechos en Baldosa" , y = "Estrato 6") + ggtitle("Proporcion de viviendas con pisos de Baldosa en estrato 6")
e3_edu_igual
e3_edu_igual <- ggplot(matrizVivienda,aes(x=Marmol,y = Estrato_6)) + geom_point(size = 2,alpha = I(0.9), col="000010")+ labs(x = "Proporcion de viviendas con pisos de hechos en Marmol" , y = "Estrato 6") + ggtitle("Proporcion de viviendas con pisos de Marmol en estrato 6")
e3_edu_igual
```
El material de pisos predominante en los estratos más altos como lo son el 5 y 6 son el mármol y la baldosa.


## Dimensión Trabajo

Organizar la clase de las variables

```{r}
Tra$encuesta_calidad.p_69<- as.integer(Tra$encuesta_calidad.p_69)
Tra$encuesta_calidad.p_74<- as.integer(Tra$encuesta_calidad.p_74)
Tra$encuesta_calidad.p_75<- as.integer(Tra$encuesta_calidad.p_75)
Tra$encuesta_calidad.p_83<- as.integer(Tra$encuesta_calidad.p_83)
Tra$encuesta_calidad.p_84<- as.integer(Tra$encuesta_calidad.p_84)
Tra$encuesta_calidad.p_100<- as.integer(Tra$encuesta_calidad.p_100)
```

Proporciones por barrio con la funcion prop.table y promedios con la función tapply.
Y cambio de nombres de las columnas que se generan.

P_69 : Actividad que realiza la mayor parte del tiempo

```{r}
 
Ocupa1 <- round(table(Tra[, c("encuesta_calidad.barrio", "encuesta_calidad.p_69")]),6) 
Ocupa_pro <- round(prop.table(Ocupa1),6) 
colnames(Ocupa_pro) = c("Trabajando","Buscando_Trabajo","Estudiando","Oficios_del_Hogar","Rentista",
                        "Jubilado_Pensionado","Otra_Actividad","Incapacitado_permanente")
```

P_74 : ¿Desea conseguir empleo o instalar un negocio? 

```{r}
Emple1 <- round(table(Tra[, c("encuesta_calidad.barrio", "encuesta_calidad.p_74")]),6) 
Emple_pro <- round(prop.table(Emple1),6) 
colnames(Emple_pro) = c("Si","No")
```

P_75 : Motivo por el cual no ha conseguido trabajo

```{r}
NoTra1 <- round(table(Tra[, c("encuesta_calidad.barrio", "encuesta_calidad.p_75")]),6) 
NoTra_pro <- round(prop.table(NoTra1),6)
colnames(NoTra_pro) = c("Ya_Encontró_Trabajo","No_Disponibilidad_Ciudad","Esperando_Llamada","No_Sabe_Buscar","Cansado_Buscar","No_Encuentra_Profesión","Esperando_TemporadaAlta","Carece_Experiencia","No_Recursos_Negocio","Empleadores_Joven_Viejo","Usted_Joven_Viejo","Responsabilidades",
                        "Problemas_Salud","Estudiando","ServicioMilitar_Policía","Planeando_Viaje","Labores_Hogar","Violencia")
```

P_83 : Medio de transporte para desplazarse hasta su lugar de trabajo

```{r}
Trans1 <- round(table(Tra[, c("encuesta_calidad.barrio", "encuesta_calidad.p_83")]),6) 
Trans_pro <- round(prop.table(Trans1),6)
colnames(Trans_pro) = c("Caminando","Bicicleta","Moto","Bus/Buseta/Ejecutivo","Transporte_Informal","Taxi/Colectivo","Transporte_Particular",
                        "Metro_Cable","SIT","Aéreo")
```

P_84 : Tiempo que emplea para desplazarse hasta su lugar de trabajo

```{r}
Tiem1 <- round(table(Tra[, c("encuesta_calidad.barrio", "encuesta_calidad.p_84")]),6) 
Tiem_pro <- round(prop.table(Tiem1),6) 
colnames(Tiem_pro) = c("0-20","21-40","41-60","61-80",">80")
```

P_100 : ¿Desea cambiar de trabajo?

```{r}
Cam1 <- round(table(Tra[, c("encuesta_calidad.barrio", "encuesta_calidad.p_100")]),6) 
Cam_pro <- round(prop.table(Cam1),6) 
colnames(Cam_pro) = c("Si","No")
```

**Matriz Dimensión Trabajo**

```{r}
DimTra1 <- cbind(Ocupa_pro,Emple_pro,NoTra_pro,Trans_pro,Tiem_pro,Cam_pro)

dim(DimTra1)
```

Para hacer las gráficas ponemos la base como un data frame

```{r}
DimTra_2 <- as.data.frame(DimTra1)
```

**Graficas descriptivas dimensión Trabajo**

Conseguir empleo ~ Ocupación

```{r}
Gra1 <- table(Tra$encuesta_calidad.p_74,Tra$encuesta_calidad.p_69)
Gra1
barplot(Gra1,  main = "¿Cuál es la actividad que más realizan las 
        personas que desean conseguir empleo?",
        xlab = "Ocupación", ylab = "Frecuencia", ylim = c(0,6000),
        col = c("royalblue", "grey"))
        legend(x = "topright", legend = c("Si", "No"), fill = c("royalblue", "grey"), 
        title = "¿Desea conseguir empleo?", cex = 0.7)
```
Se puede observar que las ocupaciones de las personas que tienen mayor deseo de conseguir trabajo o instalar su propio negocio son aquellas en su mayor parte del tiempo se dedican a buscar empleo. Al contrario de los estudiantes, rentistas, jubilados, personas que se dedican a los oficios del hogar y realizan otro tipo de actividad, que en su mayoria no desean ubicarse laboralmente. No se observan personas incapacitadas permanentemente para laborar en la encuesta.

Tiempo de desplazamiento ~ Deseo cambiar empleo

```{r}
Gra2 <- table(Tra$encuesta_calidad.p_100,Tra$encuesta_calidad.p_84)
Gra2
barplot(Gra2,  main = "¿Cuál es el rango de tiempo de desplazamiento a su lugar
        de trabajo que más emplean las personas que desean cambiar de empleo?",
        xlab = "Tiempo de desplazamiento", ylab = "Frecuencia", ylim = c(0,5500),
        col = c("royalblue", "grey"))
        legend(x = "topright", legend = c("Si", "No"), fill = c("royalblue", "grey"), 
        title = "¿Desea cambiar de empleo?", cex = 0.7)
```
Se observa que los rangos de tiempo de desplazamiento a su lugar de trabajo que más emplean las personas que desean cambiar de trabajo son entre (0,21] y (21,40] minutos. En cada uno de los rangos de tiempo son más las personas que no desean cambiar de trabajo con respecto a las que si.


Medio transporte ~ Deseo cambiar empleo

```{r}
Gra3 <- table(Tra$encuesta_calidad.p_100,Tra$encuesta_calidad.p_83)
Gra3
barplot(Gra3,  main = "¿Cuál es el medio de transporte que más utilizan
        las personas que desean cambiar de empleo?",
        xlab = "Medio de transporte", ylab = "Frecuencia", ylim = c(0,4000),
        col = c("royalblue", "grey"))
        legend(x = "topright", legend = c("Si", "No"), fill = c("royalblue", "grey"), 
        title = "¿Desea cambiar de empleo?", cex = 0.7)
```
En el diagrama podemos observar que los medios de transporte que más utilizan las personas que desean cambiar de trabajo son aquellas que se desplazan a su lugar de trabajo caminando o en bus. En cada uno de los medios de transporte se observa mayor frecuencia de las personas que no desean cambiar de trabajo con respecto a las que si. No hay personas que se desplacen en un medio de transporte aéreo que deseen cambiar de empleo.


# Agrupamiento

## Agrupamiento Dimensión Demográfica

En este caso se usó el agrupamiento jerárquico por medio de la libreria ClustVar y sus funciones hclustvar(), ya que por kmeans no era posible

```{r}
DimDemo2<- scale(DimDemo1)
```

```{r}
library(ClustOfVar)
DimDemo1tree <- hclustvar(DimDemo2)
plot(DimDemo1tree)
rect.hclust(DimDemo1tree, k=5, border=2:10)
DimDemo2tree <- hclustvar(DimDemo2[,-c(1,12,15,16)])
plot(DimDemo2tree)
rect.hclust(DimDemo2tree, k=4, border=2:10)
```

En el primero no queda tan claro el dendograma y hay algunas variables que quedan solas, por lo que en el segundo, quitandole aquellas que estaban solas queda un agrupamiento de las variables mucho mejor. También observamos que en segundo nos quedan 4 grupos en el agrupamiento.

## Agrupamiento Dimensión Educación

Se realiza el agrupamiento jerarquico, Dendograma, dada línea vertical del diagrama representa un agrupamiento que coincide con los puntos arropados por ésta, y como se ve en el dendrograma, estos van formándose progresivamente hasta tener un solo gran grupo determinado por la línea horizontal superior. Una manera de determinar entonces la cantidad de clases adecuadas es cortando el dendrograma a aquella altura del diagrama que mejor representa los datos de entrada.


```{r}
matrizEduNor<- scale(matrizEdu)

library(ClustOfVar)
tree <- hclustvar(matrizEduNor)
plot(tree)
rect.hclust(tree, k=4, border=2:10)
```


## Agrupamiento Dimensión alud

Escalar y centrar la base

```{r}
dimSalud1Normalizada<- scale(dimSalud1)
```

Agrupamiento Jerárquico, dendograma

```{r}
library(ClustOfVar)
library (stats)
tree <- hclustvar(dimSalud1Normalizada)
plot(tree)
rect.hclust(tree, k=4, border=2:10)
```


## Agrupamiento Dimensión Vivienda

Agrupamiento Jerárquico, un dendograma.

```{r}
dimViNormalizada<- scale(matrizVivienda)
library(ClustOfVar)
library(stats)
tree <- hclustvar(dimViNormalizada)
plot(tree)
rect.hclust(tree, k=6, border=2:10)
```


## Agrupamiento Dimensión Trabajo

```{r}
DimTra2<- scale(DimTra1)
library(ClustOfVar)
tree <- hclustvar(DimTra2)
plot(tree)
rect.hclust(tree, k=4, border=2:10)
```



## Mapas

Leer Archivo que contiene informacion geografica de los barrios y veredas de Medellín 
```{r}
barrios_med <- readOGR (dsn="Barrio_Vereda.shp",layer="Barrio_Vereda", encoding = "UTF-8")
nombres_barrios <- iconv(barrios_med@data$NOMBRE,"UTF-8","ISO_8859-1")

#Mapa simple
m=leaflet(barrios_med)
m=addTiles(m)
m

#Superoponemos los barrios

m=addPolygons(m,popup=nombres_barrios)
m=addTiles(m)
m

#Color a los barrios
colores=sample(x=c("orange","green","yellow"),size=length(nombres_barrios),replace=TRUE)
m=addPolygons(m,popup=nombres_barrios,color=colores)
m
```

## Conclusiones

Es curioso ver como en los estratos bajos, 1, 2 y 3 es donde se presenta una mayor proporción de personas que planifican y como en las estratos altos, 4, 5 y 6 tienen menos proporción en la planificación. También es muy interesante ver como justamente es en los estratos 1, 2 y 3 donde se presenta un mayor promedio de habitantes por vivienda, es extraño que justamente esos estratos sean los que tengan mas habitantes por vivienda, pero es así como nos muestra la encuesta que va la situación de la ciudad de Medellín y sus habitantes. Hemos de resaltar que es muy notoria la falta de personas que pertenezcana una etnia o que sepan que pertenecen a una, pues las únicas que tenían datos a resaltar, pero sin ser los más aportantes, son las etnias blanco y mestizo.


Las personas de escasos recursos, es decir, las que pertenecen a los más bajos estratos (1,2,3), son las que presentan un mayor analfabetismo, siendo este en mayor grado en las personas de estrato 2. Estas mismas comunidades presentan una menor cantidad de personas que realizaron sus estudios superiores (posgrado) y que cuentan con el título de magister o doctor. La percepción en la educación también se ve involucrada en estos aspectos, pero las personas de estratos más altos muestran un nivel de exigencia mayor, considerando que la educación no ha presentado mejora y que sigue igual, pero las personas de estratos mas bajos consideran que el nivel de educación en sus barrios ha mejorado.


 La percepción del estado de salud y de la calidad del servicio de salud se ve variado en los diferentes estatos de las personas encuestadas. Las personas que manifiestan tener un buen estado de salud se ve aumentado en mayor medida en los estratos medios. Algo similar sucede con la calidad del servicio de salud, siendo las personas de estrato 1 y 2 las que dicen tener una percepción de la calidad del servicio de salud aceptable y las de estrato 3 una percepción de un servicio de buena calidad. 


 La mayor parte de viviendas propias las tienen las personas de estratos 2, además el mayor numero de personas por hogar esta en los estratos 2 y 3, teniendo así hogares muy poblados en los lugares mas pobres, tambien se evidencia que la mayoria de hogares que son tipo apartamento son viviendas propias.El material predominante en la construccion de las viviendas para todos los estratos es el adobe revocado, sin embargo a nivel de piso solo los estratos inferiores hacer uso del cemento mientras que los mas altos suelen usar material como Marmol ó Baldosa.


En conclusión, las variables escogidas para explicar el comportamiento de las personas con respecto a su condición de empleo o desempleo, nos muestran que es más el deseo de permanecer en su trabajo actual que buscar nuevas ofertas laborales, debido a la falta de oportunidades y a la alta demanda de empleo.


## Referencias

https://bookdown.org/jboscomendoza/r-principiantes4/data-frames.html

https://rstudio.github.io/leaflet/map_widget.html

https://www.datanalytics.com/libro_r/ejemplos-1.html

http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/

https://rpubs.com/daniballari/ggplot

https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/rect.hclust

https://rpubs.com/mjimcua/clustering-jerarquico-en-r

https://rpubs.com/kfhidalgoh/300948
